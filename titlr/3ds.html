<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Блог Флешки - Titlr-3DS</title>
  <meta name="description" content="Загрузка бесплатных тайтлов с NUS!">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Titlr-3DS">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://snowflash383935.github.io/titlr/3ds">
  <meta property="og:description" content="Загрузка бесплатных тайтлов с NUS!">
  <meta property="og:site_name" content="Блог Флешки">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://snowflash383935.github.io/titlr/3ds">
  <meta name="twitter:title" content="Titlr-3DS">
  <meta name="twitter:description" content="Загрузка бесплатных тайтлов с NUS!">

  
    <meta property="og:image" content="https://snowflash383935.github.io/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
    <meta name="twitter:image" content="https://snowflash383935.github.io/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
  

  <link href="https://snowflash383935.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Блог Флешки Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-dark-11327753546b2135c989eee5cd83497a2734b702928d016839d795f6c706e3d5.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-d161409442b7e523089f24d08d0a55951549ece7504207c376d53b020713494d.png">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-bb1553a18d0f1ccfe1aabc010584c49b4277a88503216b78906ba719e30019c1.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-831218bc9e41aef39ee6a0bae4501195bccafcc13101ae2b9cd20493a6ec04c0.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Блог Флешки">Блог Флешки</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
      <li>
        <a href="https://github.com/SnowFlash383935" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:snowflash383935@mail.ru" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a onclick="toggle()" title="Переключить тему">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/jekyll">Jekyll</a></li>
    
      
        <li><a href="/tag/web">Web</a></li>
    
      
        <li><a href="/tag/дизайн">Дизайн</a></li>
    
  </ul>



  <form action="/search" method="get">
    <input type="text" id="search_field" name="query" placeholder="Поиск по постам...">
    <button type='submit'>Искать</button>
  </form>


        <!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>NUS 3DS downloader</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:2rem}
  input{width:14rem;font-family:monospace}
  button{padding:.4rem 1rem}
  #log{white-space:pre-wrap;font-size:13px;margin-top:1rem;max-height:400px;overflow:auto;border:1px solid #ccc;padding:.5rem}
  .err{color:#c00}
  .ok{color:#080}
</style>
</head>
<body>

<h1>NUS 3DS downloader (без сервера)</h1>

<label>Title-ID (16 hex): <input id="tid" maxlength="16" placeholder="0004013800000002"></label><br><br>
<label>Версия (не обязательно): <input id="ver" type="number" min="0" placeholder="latest"></label><br><br>
<button id="go">Скачать</button>

<div id="log"></div>
<script src="https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/streamsaver@2.0.3/StreamSaver.min.js"></script>
<script type="module">
/* ---------- tiny helpers ---------- */
const $ = q => document.querySelector(q);
const log = (s, ok=true) => {
  const d = document.createElement('div');
  d.textContent = '> ' + s;
  d.className = ok ? 'ok' : 'err';
  $('#log').appendChild(d);
  d.scrollIntoView({block:'end'});
};

/* ---------- NUS base ---------- */
const CDN = 'https://nus.cdn.c.shop.nintendowifi.net/ccs/download/';

/* ---------- simple TMD parser ---------- */
function parseTMD(buf){
  const view = new DataView(buf);
  let off = 0x04 + view.getUint32(0x00, false); // skip signature
  const issuer = new TextDecoder().decode(buf.slice(off, off+0x40)).replace(/\0/g,'');
  off += 0x40;
  const version   = view.getUint8(off+0x00);
  const ca_crl    = view.getUint8(off+0x01);
  const signer_crl= view.getUint8(off+0x02);
  off += 0x04;
  const sysver    = view.getBigUint64(off, false); off+=8;
  const titleId   = view.getBigUint64(off, false); off+=8;
  off += 0x0E; // пропускаем ненужные поля
  const titleVer  = view.getUint16(off, false); off+=2;
  const contentCnt= view.getUint16(off, false); off+=2;
  off = 0x1C4; // фиксированный офсет до ContentInfo (64×0x24)
  const contents = [];
  for(let i=0;i<contentCnt;i++){
    const cid   = view.getUint32(off, false);
    const idx   = view.getUint16(off+4, false);
    const type  = view.getUint16(off+6, false);
    const size  = view.getBigUint64(off+8, false);
    const hash  = buf.slice(off+0x10, off+0x30);
    contents.push({cid:cid.toString(16).padStart(8,'0'), size, hash});
    off += 0x30;
  }
  return {titleId, titleVer, contentCnt, contents};
}

/* ---------- download ---------- */
async function fetchBlob(url, desc){
  log(`GET ${desc||url}`);
  const r = await fetch(url);
  if(!r.ok) throw new Error(`${r.status} ${r.statusText}`);
  return r.arrayBuffer();
}
const streamSaver = window.streamSaver
function saveStream(filename, size){
  const fileStream = streamSaver.createWriteStream(filename, {size});
  return fileStream.getWriter();
}

/* ---------- main ---------- */
$('#go').onclick = async () => {
  $('#log').textContent = '';
  try{
    const tid  = $('#tid').value.trim().toLowerCase();
    if(!/^[0-9a-f]{16}$/.test(tid)) throw new Error('Title-ID должен быть 16 hex-символов');
    const ver  = $('#ver').value ? Number($('#ver').value) : null;

    const tmdUrl = CDN + tid + '/' + (ver ? `tmd.${ver}` : 'tmd');
    const tmdBuf = await fetchBlob(tmdUrl, 'TMD');
    const tmd    = parseTMD(tmdBuf);
    log(`TMD v${tmd.titleVer}, ${tmd.contentCnt} кусков`, true);

    // сохраняем TMD
    const tmdFile = await saveStream(`${tid}-tmd`, tmdBuf.byteLength);
    await tmdFile.write(new Uint8Array(tmdBuf));
    await tmdFile.close();

    // ticket (опционально)
    try{
      const cetkBuf = await fetchBlob(CDN + tid + '/cetk', 'Ticket');
      const cetkFile = await saveStream(`${tid}-cetk`, cetkBuf.byteLength);
      await cetkFile.write(new Uint8Array(cetkBuf));
      await cetkFile.close();
      log('Ticket сохранён', true);
    }catch(e){ log('Ticket отсутствует', false); }

    // куски
    for(const c of tmd.contents){
      const url = CDN + tid + '/' + c.cid;
      const resp = await fetch(url);
      if(!resp.ok) throw new Error(`кусок ${c.cid} недоступен`);
      const total = Number(c.size);
      const writer = await saveStream(`${tid}-${c.cid}.app`, total);
      const reader = resp.body.getReader();
      let done = 0;
      while(true){
        const {value, done:d} = await reader.read();
        if(d) break;
        done += value.length;
        await writer.write(value);
        const pct = (100*done/total).toFixed(1);
        log(`  ${c.cid}  ${pct}%`, true);
      }
      await writer.close();
    }
    log('Готово!', true);
  }catch(e){ log(e.message||e, false); }
};
</script>

</body>
</html>

        <footer class="footer scrollappear">
  <p>
    Это - особый код для блога от 
    <a href="/about" title="Обо мне">Флешки</a>, основанный на Chalk. Скачать можно <a href="https://github.com/SnowFlash383935/SnowFlash383935.github.io" rel="noreferrer noopener" target="_blank" title="Репозиторий">туть</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-28631876-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-28631876-6');
  </script>


<script src="/assets/vendor-3ee2c63bbac916f96cd7f90e83ab767f058ead1301444c9966f5156911c8be7f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


  <script src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js" type="text/javascript"></script>


<style>
.copy-button {
  position: absolute;
  top: 8px;
  right: 8px;
  background: rgba($body-background, 0.8);
  border: 1px solid $base-border-color;
  border-radius: 4px;
  padding: 4px;
  cursor: pointer;
  color: $base-font-color;
  transition: all 0.2s ease;
  z-index: 10;
  
  &:hover {
    background: $base-border-color;
    border-color: $base-accent-color;
  }
  
  &.copied {
    color: $base-accent-color;
    border-color: $base-accent-color;
  }
  
  svg {
    display: block;
  }
}

// Для родительского контейнера кода
.highlight {
  position: relative;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Находим все блоки кода
  document.querySelectorAll('pre.highlight').forEach(pre => {
    // Создаем кнопку
    const button = document.createElement('button');
    button.className = 'copy-button';
    button.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>';
    button.title = 'Copy to clipboard';
    
    // Вставляем кнопку перед pre (чтобы не было внутри кода)
    pre.parentNode.insertBefore(button, pre);
    
    // Обработчик клика
    button.addEventListener('click', () => {
      const code = pre.querySelector('code');
      navigator.clipboard.writeText(code.innerText).then(() => {
        // Меняем иконку на галочку
        button.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
        button.classList.add('copied');
        
        // Через 2 секунды возвращаем исходную иконку
        setTimeout(() => {
          button.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>';
          button.classList.remove('copied');
        }, 2000);
      });
    });
  });
});
</script>

</body>
</html>
