---
title: "Titlr-3DS"
description: "Загрузка бесплатных тайтлов с NUS!"
permalink: /titlr/3ds
sitemap: true
layout: default
---
<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>NUS 3DS downloader</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:2rem}
  input{width:14rem;font-family:monospace}
  button{padding:.4rem 1rem}
  #log{white-space:pre-wrap;font-size:13px;margin-top:1rem;max-height:400px;overflow:auto;border:1px solid #ccc;padding:.5rem}
  .err{color:#c00}
  .ok{color:#080}
</style>
</head>
<body>

<h1>NUS 3DS downloader (без сервера)</h1>

<label>Title-ID (16 hex): <input id="tid" maxlength="16" placeholder="0004013800000002"></label><br><br>
<label>Версия (не обязательно): <input id="ver" type="number" min="0" placeholder="latest"></label><br><br>
<button id="go">Скачать</button>

<div id="log"></div>
<script src="https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/streamsaver@2.0.3/StreamSaver.min.js"></script>
<script type="module">
/* ---------- tiny helpers ---------- */
const $ = q => document.querySelector(q);
const log = (s, ok=true) => {
  const d = document.createElement('div');
  d.textContent = '> ' + s;
  d.className = ok ? 'ok' : 'err';
  $('#log').appendChild(d);
  d.scrollIntoView({block:'end'});
};

/* ---------- NUS base ---------- */
const CDN = 'https://nus.cdn.c.shop.nintendowifi.net/ccs/download/';

/* ---------- simple TMD parser ---------- */
function parseTMD(buf){
  const view = new DataView(buf);
  let off = 0x04 + view.getUint32(0x00, false); // skip signature
  const issuer = new TextDecoder().decode(buf.slice(off, off+0x40)).replace(/\0/g,'');
  off += 0x40;
  const version   = view.getUint8(off+0x00);
  const ca_crl    = view.getUint8(off+0x01);
  const signer_crl= view.getUint8(off+0x02);
  off += 0x04;
  const sysver    = view.getBigUint64(off, false); off+=8;
  const titleId   = view.getBigUint64(off, false); off+=8;
  off += 0x0E; // пропускаем ненужные поля
  const titleVer  = view.getUint16(off, false); off+=2;
  const contentCnt= view.getUint16(off, false); off+=2;
  off = 0x1C4; // фиксированный офсет до ContentInfo (64×0x24)
  const contents = [];
  for(let i=0;i<contentCnt;i++){
    const cid   = view.getUint32(off, false);
    const idx   = view.getUint16(off+4, false);
    const type  = view.getUint16(off+6, false);
    const size  = view.getBigUint64(off+8, false);
    const hash  = buf.slice(off+0x10, off+0x30);
    contents.push({cid:cid.toString(16).padStart(8,'0'), size, hash});
    off += 0x30;
  }
  return {titleId, titleVer, contentCnt, contents};
}

/* ---------- download ---------- */
async function fetchBlob(url, desc){
  log(`GET ${desc||url}`);
  const r = await fetch(url);
  if(!r.ok) throw new Error(`${r.status} ${r.statusText}`);
  return r.arrayBuffer();
}
import streamSaver from 'streamsaver'
function saveStream(filename, size){
  const fileStream = streamSaver.createWriteStream(filename, {size});
  return fileStream.getWriter();
}

/* ---------- main ---------- */
$('#go').onclick = async () => {
  $('#log').textContent = '';
  try{
    const tid  = $('#tid').value.trim().toLowerCase();
    if(!/^[0-9a-f]{16}$/.test(tid)) throw new Error('Title-ID должен быть 16 hex-символов');
    const ver  = $('#ver').value ? Number($('#ver').value) : null;

    const tmdUrl = CDN + tid + '/' + (ver ? `tmd.${ver}` : 'tmd');
    const tmdBuf = await fetchBlob(tmdUrl, 'TMD');
    const tmd    = parseTMD(tmdBuf);
    log(`TMD v${tmd.titleVer}, ${tmd.contentCnt} кусков`, true);

    // сохраняем TMD
    const tmdFile = await saveStream(`${tid}-tmd`, tmdBuf.byteLength);
    await tmdFile.write(new Uint8Array(tmdBuf));
    await tmdFile.close();

    // ticket (опционально)
    try{
      const cetkBuf = await fetchBlob(CDN + tid + '/cetk', 'Ticket');
      const cetkFile = await saveStream(`${tid}-cetk`, cetkBuf.byteLength);
      await cetkFile.write(new Uint8Array(cetkBuf));
      await cetkFile.close();
      log('Ticket сохранён', true);
    }catch(e){ log('Ticket отсутствует', false); }

    // куски
    for(const c of tmd.contents){
      const url = CDN + tid + '/' + c.cid;
      const resp = await fetch(url);
      if(!resp.ok) throw new Error(`кусок ${c.cid} недоступен`);
      const total = Number(c.size);
      const writer = await saveStream(`${tid}-${c.cid}.app`, total);
      const reader = resp.body.getReader();
      let done = 0;
      while(true){
        const {value, done:d} = await reader.read();
        if(d) break;
        done += value.length;
        await writer.write(value);
        const pct = (100*done/total).toFixed(1);
        log(`  ${c.cid}  ${pct}%`, true);
      }
      await writer.close();
    }
    log('Готово!', true);
  }catch(e){ log(e.message||e, false); }
};
</script>

</body>
</html>
